<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Exerc√≠cio 1 - Playlist Interativa (TODO)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/style.css">
</head>

<body>
  <div class="glass playlist-card">
    <h1>Playlist Interativa - TODO List</h1>
    <div class="row g-2 align-items-center">
      <div class="col-md-8">
        <input id="inputSong" class="form-control" placeholder="Digite o nome da m√∫sica / item da playlist"
          aria-label="M√∫sica">
      </div>
      <div class="col-md-4 d-flex">
        <button id="btnAdd" class="btn btn-primary me-2 btn-scale">Incluir (push)</button>
        <button id="btnPop" class="btn btn-outline-danger me-2">Remover √∫ltimo (pop)</button>
        <button id="btnClear" class="btn btn-outline-secondary">Limpar tudo</button>
      </div>
    </div>

    <div class="row mt-3 g-2">
      <div class="col-md-6 d-flex">
        <button id="btnSort" class="btn btn-success me-2">Ordenar (sort)</button>
        <button id="btnShuffle" class="btn btn-warning me-2">Embaralhar</button>
        <button id="btnExport" class="btn btn-outline-primary me-2">Exportar JSON</button>
        <button id="btnImport" class="btn btn-outline-secondary">Importar JSON</button>
      </div>
      <div class="col-md-6 d-flex justify-content-end align-items-center">
        <input id="inputFilter" class="form-control me-2" placeholder="Filtrar (filter) - pressione Enter"
          style="max-width:280px;">
        <button id="btnFilterClear" class="btn btn-outline-secondary">Limpar Filtro</button>
      </div>
    </div>

    <div id="playlist" class="mt-4"></div>

    <template id="songTemplate">
      <div class="song-item bg-white border">
        <div class="song-text"></div>
        <div class="controls btn-group" role="group"></div>
      </div>
    </template>

    <div class="mt-3 small-muted">Dica: voc√™ pode editar itens (bot√£o ‚úèÔ∏è), excluir (lixeira) ou ouvir (√≠cone de √°udio
      fict√≠cio).</div>
    <a href="./semana03.html">Voltar</a>
  </div>

  <script>
    // Modelo de dados: um array simples de strings
    let playlist = [
      'Bohemian Rhapsody - Queen',
      'Imagine - John Lennon',
      'Smells Like Teen Spirit - Nirvana'
    ];

    const playlistEl = document.getElementById('playlist');
    const template = document.getElementById('songTemplate');
    const inputSong = document.getElementById('inputSong');
    const inputFilter = document.getElementById('inputFilter');

    // Renderiza a lista usando for...of
    function render(filterText = '') {
      playlistEl.innerHTML = '';
      const normalizedFilter = String(filterText || '').trim().toLowerCase();
      if (playlist.length === 0) {
        playlistEl.innerHTML = '<div class="empty">A playlist est√° vazia - inclua m√∫sicas!</div>';
        return;
      }

      for (const [index, song] of playlist.entries()) {
        // Aplica filtro (filter)
        if (normalizedFilter) {
          if (!song.toLowerCase().includes(normalizedFilter)) continue;
        }

        const node = template.content.cloneNode(true);
        const item = node.querySelector('.song-item');
        const text = node.querySelector('.song-text');
        const controls = node.querySelector('.controls');

        text.textContent = song;

        // Bot√µes: Editar, Excluir, Ouvir (fict√≠cio), Subir, Descer
        const btnEdit = document.createElement('button');
        btnEdit.className = 'btn btn-sm btn-outline-secondary';
        btnEdit.title = 'Editar';
        btnEdit.innerHTML = '‚úèÔ∏è';
        btnEdit.addEventListener('click', () => editarItem(index));

        const btnDelete = document.createElement('button');
        btnDelete.className = 'btn btn-sm btn-outline-danger';
        btnDelete.title = 'Excluir';
        btnDelete.innerHTML = 'üóëÔ∏è';
        btnDelete.addEventListener('click', () => excluirItem(index));

        const btnMoveUp = document.createElement('button');
        btnMoveUp.className = 'btn btn-sm btn-outline-info';
        btnMoveUp.title = 'Mover para cima';
        btnMoveUp.innerHTML = '‚¨ÜÔ∏è';
        btnMoveUp.addEventListener('click', () => moverParaCima(index));

        const btnMoveDown = document.createElement('button');
        btnMoveDown.className = 'btn btn-sm btn-outline-info';
        btnMoveDown.title = 'Mover para baixo';
        btnMoveDown.innerHTML = '‚¨áÔ∏è';
        btnMoveDown.addEventListener('click', () => moverParaBaixo(index));

        const btnPlay = document.createElement('button');
        btnPlay.className = 'btn btn-sm btn-outline-success';
        btnPlay.title = 'Ouvir (simulado)';
        btnPlay.innerHTML = '‚ñ∂Ô∏è';
        btnPlay.addEventListener('click', () => alert('Now playing: ' + song));

        controls.appendChild(btnPlay);
        controls.appendChild(btnEdit);
        controls.appendChild(btnDelete);
        controls.appendChild(btnMoveUp);
        controls.appendChild(btnMoveDown);

        playlistEl.appendChild(node);
      }

      if (playlistEl.children.length === 0) {
        playlistEl.innerHTML = '<div class="empty">Nenhum item corresponde ao filtro.</div>';
      }
    }

    // Incluir (push)
    function adicionarItem() {
      const val = inputSong.value.trim();
      if (val === '') {
        inputSong.focus();
        return;
      }
      // push
      playlist.push(val);
      inputSong.value = '';
      render(inputFilter.value);
    }

    // Excluir (remover um item por √≠ndice)
    function excluirItem(idx) {
      if (idx < 0 || idx >= playlist.length) return;
      if (!confirm('Excluir \"' + playlist[idx] + '\" da playlist?')) return;
      // remove com splice (equivalente a excluir espec√≠fico)
      playlist.splice(idx, 1);
      render(inputFilter.value);
    }

    // Editar (substitui o texto do item)
    function editarItem(idx) {
      const atual = playlist[idx];
      const novo = prompt('Editar item:', atual);
      if (novo === null) return; // cancelou
      const trimmed = String(novo).trim();
      if (trimmed === '') { alert('Valor inv√°lido.'); return; }
      playlist[idx] = trimmed;
      render(inputFilter.value);
    }

    // Remover √∫ltimo (pop)
    function removerUltimo() {
      if (playlist.length === 0) return;
      const last = playlist[playlist.length - 1];
      if (!confirm('Remover √∫ltimo item: \"' + last + '\" ?')) return;
      // pop
      playlist.pop();
      render(inputFilter.value);
    }

    // Ordenar (sort) - alfab√©tica, case-insensitive
    function ordenar() {
      playlist.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
      render(inputFilter.value);
    }

    // Embaralhar (exemplo usando Fisher-Yates)
    function embaralhar() {
      for (let i = playlist.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [playlist[i], playlist[j]] = [playlist[j], playlist[i]];
      }
      render(inputFilter.value);
    }

    // Mover para cima/baixo
    function moverParaCima(idx) {
      if (idx <= 0) return;
      [playlist[idx - 1], playlist[idx]] = [playlist[idx], playlist[idx - 1]];
      render(inputFilter.value);
    }
    function moverParaBaixo(idx) {
      if (idx >= playlist.length - 1) return;
      [playlist[idx], playlist[idx + 1]] = [playlist[idx + 1], playlist[idx]];
      render(inputFilter.value);
    }

    // Export / Import JSON (simples)
    function exportarJSON() {
      const json = JSON.stringify(playlist, null, 2);
      // mostra em uma janela para copiar (op√ß√£o simples)
      prompt('Copie seu JSON da playlist:', json);
    }

    function importarJSON() {
      const txt = prompt('Cole aqui o JSON da playlist (array de strings):');
      if (!txt) return;
      try {
        const arr = JSON.parse(txt);
        if (!Array.isArray(arr) || !arr.every(x => typeof x === 'string')) {
          alert('Formato inv√°lido. Precisa ser um array de strings.');
          return;
        }
        playlist = arr.slice(); // substituir
        render(inputFilter.value);
      } catch (e) {
        alert('JSON inv√°lido: ' + e.message);
      }
    }

    // Limpar tudo
    function limparTudo() {
      if (!confirm('Limpar toda a playlist?')) return;
      playlist = [];
      render();
    }

    // Eventos
    document.getElementById('btnAdd').addEventListener('click', () => adicionarItem());
    document.getElementById('btnPop').addEventListener('click', () => removerUltimo());
    document.getElementById('btnSort').addEventListener('click', () => ordenar());
    document.getElementById('btnShuffle').addEventListener('click', () => embaralhar());
    document.getElementById('btnExport').addEventListener('click', () => exportarJSON());
    document.getElementById('btnImport').addEventListener('click', () => importarJSON());
    document.getElementById('btnClear').addEventListener('click', () => limparTudo());
    document.getElementById('btnFilterClear').addEventListener('click', () => { inputFilter.value = ''; render(); });

    inputSong.addEventListener('keyup', (e) => { if (e.key === 'Enter') adicionarItem(); });
    inputFilter.addEventListener('keyup', (e) => { if (e.key === 'Enter') render(inputFilter.value); });

    // Render inicial usando for...of
    render();

  </script>
</body>

</html>